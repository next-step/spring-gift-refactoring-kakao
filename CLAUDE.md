# CLAUDE.md — 1단계 리팩터링 준비 작업 가이드 (Claude Code용)

## 0. 최우선 원칙 (반드시 준수)
- **tmp/1단계_요구사항.md**를 최상위 기준으로 삼는다. (상충 시 해당 문서 우선)
- 이번 단계 목표는 **작동(behavior)은 유지**하면서 **구조 변경으로 변경 난이도를 낮추는 것**이다.
- 이번 단계에서는 **신규 기능 추가 금지**, **작동 변경 금지**.
- 구조 변경과 작동 변경을 섞지 않는다. (이번 단계는 “구조 변경”만)
- 테스트를 회피/비활성화하지 않는다. 최소 요구사항: **변경 후 전체 테스트 통과**.

## 1. 작업 진행 방식 (한 번에 몰아서 하지 말 것)
### 1.1 반드시 “단계별”로 진행
- 요구사항을 한 번에 수행하지 말고, **작은 단계로 쪼개서** 진행한다.
- 작업 단계(큰 흐름)는 `tmp/단계.md`에 정리하고 계속 업데이트한다.

### 1.2 작업 시작 전 반드시 질문
- 실제 코드/파일 변경을 시작하기 전에, 항상 아래를 먼저 수행:
    1) **plan을 작성**
    2) plan을 사용자에게 보여줌
    3) **“이 plan대로 진행해도 될까요?”** 라고 물어본 뒤 승인받고 진행

> 승인 없이 코드 수정/파일 수정/대량 변경을 시작하지 않는다.

## 2. 반드시 생성/갱신해야 하는 산출물
### 2.1 README.md (프로젝트 루트)
- 작업 시작 전에 README.md에 아래를 작성한다.
    - 구현(리팩터링) 기능 목록(체크리스트)
    - 구현 전략(어떤 순서로, 어떤 기준으로)
- 작업이 추가되면 README 체크리스트도 같이 갱신한다.
- AI 도구를 활용했다면 README.md에 아래를 기록한다.
    - 활용한 방식(어디에, 무엇을)
    - Claude/AI가 만든 코드에서 무엇을 수정했는지
    - 무엇을 학습했는지(짧게라도)

### 2.2 tmp/단계.md
- “전체 작업을 어떤 단계로 나눠 진행할지”를 기록한다.
- 각 단계는 아래 템플릿을 권장:
    - 단계 이름
    - 목표(작동 변경 없음 명시)
    - 변경 대상 파일(예상)
    - 검증 방법(테스트/정적 분석/포매터)
    - 예상 리스크 및 롤백 전략

### 2.3 tmp/plan.md (또는 plan.md)
- **지금부터 바로 수행할 ‘다음 변경 1개’**만 적는 단기 계획 파일
- plan에는 반드시 포함:
    - 목표(왜 하는지)
    - 범위(수정 파일/클래스)
    - 제약(작동 변경 금지, 신규 기능 금지 등)
    - 검증 명령(어떤 테스트/분석을 돌릴지)

### 2.4 tmp/판단근거.md
- 요구사항에서 “근거 제시”가 필요한 판단을 모두 기록한다.
- 특히 **불필요한 코드 제거**는 아래 근거를 반드시 남긴다:
    - IDE/정적분석에서 “미사용”으로 확인한 증거
    - 주변 주석/TODO 의도 유무 확인 결과
    - git blame으로 “누가/왜 추가했는지” 확인 결과
    - 이후 단계(작동 변경)와 충돌 가능성 검토 결과
- 서비스 계층 추출 시에도:
    - Controller에서 어떤 로직을 Service로 옮겼는지
    - “왜 비즈니스 로직인가” 판단 근거
    - 작동 동일성 보장을 위해 어떤 테스트/검증을 했는지
    - 를 기록한다.

## 3. 커밋 정책 (매우 중요)
- Claude Code는 **직접 커밋하지 않는다.**
- 대신, 각 단계 완료 후 **커밋 메시지 ‘제안’만** 한다.
- 커밋 메시지는 AngularJS Git Commit Message Conventions를 따른다.
- 한 커밋에는 목적 1개만 담는다. (diff를 30초 내 설명 못 하면 더 쪼갠다)

### 커밋 메시지 제안 예시
- `docs(readme): add stage-1 checklist and strategy`
- `style: normalize formatting`
- `chore: remove unused imports and dead code`
- `refactor(controller): extract service layer and thin controllers`
- `test: adjust tests after refactor (no behavior change)`

## 4. 1단계에서 해야 할 리팩터링 범위
### 4.1 스타일 정리 (작동 변경 없음)
- 프로젝트 전반의 스타일 불일치를 **도구 우선**(포매터/린터/IDE 인스펙션)으로 정리한다.
- 스타일 정리로 인해 작동이 바뀌면 안 된다.

### 4.2 불필요한 코드 제거 (작동 변경 없음)
- IDE/정적 분석 도구가 “미사용”으로 표시한 항목 제거 가능
- 삭제 전 근거를 반드시 `tmp/판단근거.md`에 남길 것
- 삭제 범위는 작게 쪼개서 진행(한 번에 너무 많이 삭제하지 않음)

### 4.3 서비스 계층 추출 (구조 변경, 작동 변경 없음)
- Controller의 비즈니스 로직을 Service로 이동한다.
- Controller는 요청 검증과 위임만 담당하도록 얇게 만든다.
- 신규 기능 추가 금지.
- 단계별로 하나의 컨트롤러/유스케이스씩 진행.

## 5. 검증(Verification) 규칙
- 매 단계(또는 작은 변경)마다 아래를 수행하고 결과를 요약한다:
    - 전체 테스트 실행(프로젝트에 맞는 명령 자동 탐색 후 제안)
    - 정적 분석/린터(있다면)
    - 포매터(있다면)
- “작동 변경 없음”을 스스로 점검하고, 의심되면 즉시 중단 후 사용자에게 보고/질문한다.

## 6. 보고 방식 (사용자에게 보여줄 것)
매 단계 완료 시 아래를 제공:
- 변경 요약(무슨 구조 변경을 했는지)
- 영향 범위(수정 파일/클래스)
- 검증 결과(테스트/분석 결과)
- `tmp/판단근거.md` 갱신 내용 요약
- 커밋 메시지 제안(직접 커밋 X)
- 다음 단계 계획(plan) 초안 + 진행해도 되는지 질문